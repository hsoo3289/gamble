<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="soo.spring.mybatis.board">

	<resultMap type="Board" id="board">

		<result property="seq" column="SEQ" />
		<result property="writer_seq" column="WRITER_SEQ" />
		<result property="subject" column="SUBJECT" />
		<result property="content" column="CONTENT" />
		<result property="cdate" column="CDATE" />
		<result property="rdate" column="RDATE" />
		<result property="parent_seq" column="PARENT_SEQ" />
		<result property="name" column="NAME" />
		<result property="nick" column="NICK" />
		<result property="id" column="ID" />
		<result property="pwd" column="PWD" />
		<result property="email" column="EMAIL" />
		<result property="phone" column="PHONE" />
		<result property="joindate" column="JOINDATE" />
		<result property="ssn" column="SSN" />
		<result property="level_level" column="REPLY_LEVEL" />
		<result property="count" column="COUNT" />
		<result property="like_count" column="LIKE_COUNT" />
		<result property="dbName" column="dbName" />
		<result property="method" column="method" />
	</resultMap>

	<select id="mySelectAll" resultType="Board">
		select * from BOARD_VIEW
	</select>

	<select id="list" resultType="Board" parameterType="Page">
		<choose>
			<when test="searchMode == false">
				select *
				from BOARD_VIEW where ROWNUMBER between
				#{begin} and #{end}
			</when>

			<otherwise>
				select * from
				(select ROWNUM as RN, BOARD_VIEW.* from
				BOARD_VIEW 
				where ${col} like '%'||#{keyWord}||'%')
				BOARD_SEARCH
				where RN between
				#{begin} and #{end}
			</otherwise>
		</choose>

	</select>

	<select id="pagecount" resultType="int" parameterType="Page">
		<choose>
			<when test="searchMode == false">
				select count(seq) from BOARD_VIEW
			</when>

			<otherwise>
				select count(*) from
				(select * from
				BOARD_VIEW 
				where ${col} like '%'||#{keyWord}||'%')
			</otherwise>
		</choose>
	</select>

	<insert id="insert" parameterType="Board">
		insert into
		BOARD(SEQ,WRITER_SEQ,SUBJECT,CONTENT,CDATE
		<if test="parent_seq > 0">, PARENT_SEQ</if>
		)
		values(#{seq},#{writer_seq},#{subject},
		#{content},SYSDATE
		<if test="parent_seq > 0">, #{parent_seq}</if>
		)
	</insert>

	<update id="update" parameterType="Board">
		update BOARD set
		SUBJECT=#{subject},CONTENT=#{content},RDATE=SYSDATE
		WHERE SEQ=#{seq}
	</update>

	<delete id="delete" parameterType="long">
		delete from BOARD where
		SEQ=#{seq}
	</delete>

	<select id="item" parameterType="long" resultType="Board">
		select *
		from BOARD_VIEW where SEQ=#{seq}
	</select>

	<select id="myChildren" parameterType="long" resultType="Board">
		select
		SEQ, F_PATH from board_view
		start with seq = #{seq}
		connect by prior seq
		= parent_seq
	</select>

	<select id="mySearch" parameterType="hashmap" resultType="Board">
		select
		*
		from board_view
		start with ${col} like '%'||#{keyWord}||'%'
		connect by
		prior seq = parent_seq
	</select>

	<update id="count" parameterType="Board">
		update BOARD set
		${method}=${method}+1 where SEQ=#{seq}
	</update>
	
	<select id="count_get" parameterType="Board" resultType="int">
		select ${method} from BOARD
		where SEQ=#{seq}
	</select>
	
	<select id="nextseq" resultType="long">
		select BOARD_SEQ.NEXTVAL from DUAL
	</select>
	
</mapper>
